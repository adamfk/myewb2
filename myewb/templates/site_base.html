{% extends "base.html" %}

{% load i18n %}
{# {% load openid_tags %} #}
{% load ifsetting_tag %}
{% load analytics %}



{% block extra_head_base %}
		<link rel="SHORTCUT ICON" href="{{ STATIC_URL}}favicon.ico" />
		<link rel="stylesheet" href="{{ STATIC_URL }}pinax/css/topics.css" />
		<link rel="stylesheet" href="{{ STATIC_URL }}css/social_project.css" />
		<script type="text/javascript" src="{{ STATIC_URL }}pinax/js/topics.js"></script>
		<script type="text/javascript" src="{{ STATIC_URL }}base.js"></script>
		{% block extra_head %}{% endblock %}
		<link rel="stylesheet" href="{{ STATIC_URL }}css/myewb2.css" />
		
		
		<script type="text/javascript" src="{{ STATIC_URL }}js/jquery-ui.js"></script>
        <link rel="stylesheet" href="{{ STATIC_URL }}css/jquery-ui.css" />


		<link rel="stylesheet" href="{{ STATIC_URL }}css/myewb2-posts.css" />  {# @@@ this is now standard - need to take it out where it's loaded secondly #}

		<link rel="stylesheet" href="{{ STATIC_URL }}css/segmented_control.css" />
		
		
		<script type="text/javascript">
		
//  External links in posts, etc., should open in a new window    
$(document).ready(function(){
	$(".textbody a[ href^='http']").attr('target','_blank');
	
	$(".openlinks a").attr('target','_blank');
});
		
		
        $(document).ready(function() {
    		  $('.toolbarheader').click(function(){	
                $(this).next().slideToggle();
                $(this).toggleClass('hidebox');
                if($(this).attr('id')) {
                    //console.log($(this).attr('id'));
                    
                    {% if user.is_authenticated %}
                    var action = "";
                    if ($(this).hasClass('hidebox'))
                        action = "close";
                    else
                        action = "show";
                    
                    $.ajax({
                      url: "{% url profile_toolbar_action %}" + action + "/" + $(this).attr('id') + "/",
                      cache: false,  // this prepends another query onto the end with a timestamp - make sure it doesn't mix up the handler page?
                      
                      //success: function(html){
                      //  console.log(html);
                      //}   // just for debugging; not actually required to send anything back.
                    });
                    {% endif %}
                    {# state saving only works if youre logged in, so only really try then #}
                    
                    
                } else {
                    //console.log('no id');
                }
                // indicates that the box *below* is hidden

          	  });
          	  
        {% block frontpagerightJS %}

          	  
        {% endblock frontpagerightJS %}
          	  
          	  

            // process saved settings, hide previously closed toolbars 
            {% for t in closed_toolbars %}
                {% ifequal t "toolbarcolumn_right_container" %}
                    $('#toolbarcolumn_right_container').hide();
                    $('#toolbarcolumn_right_show').show();
                {% else %}
                	var tbox = $('#{{ t }}');
                	tbox.next().hide();
                	tbox.addClass('hidebox');
            	
            	{% endifequal %}
            {% endfor %}
		
        });
        
        

    {% if user.is_authenticated %}
// Watch-list JS code
// should this be stored somewhere more post-specific?
	$(document).ready(function() {
		$('.watchlist-toggle').click(function() {
		
		  var topicID = $(this).attr('id').substring('17');
		  
		  console.log(topicID);
		  
		  if($(this).hasClass('toggle-remove')) {
		      // remove it from the watchlist when clicked
                $(this).html("removing...");
				$(this).load('{% url topic_watchlist_remove user.pk %}' + topicID + '/');
				
				$(this).removeClass('toggle-remove');
				$(this).addClass('toggle-add');
		  } else {
                $(this).html("adding...");
				$(this).load('{% url topic_watchlist_add user.pk %}' + topicID + '/');
				
				$(this).removeClass('toggle-add');
				$(this).addClass('toggle-remove');
		  }
		
			return false;
		});
	});
    
    {% endif %}
        
        


        
        
        
        
		</script>
		
{% endblock %}

{% block login %}
	{% ifnotequal request.path "/account/login/" %}
	<div class="login">
    {% if user.is_authenticated %}
		Signed in as <a class="username" href="{% url profile_detail user %}"><strong>{{ user.visible_name }}</strong></a>.
		<br/>
		<a href="{% url messages_inbox %}">{{ messages_inbox_count }} unread message{% ifnotequal messages_inbox_count 1 %}s{% endifnotequal %}</a>
		
		<a class="signout" href="{% url acct_logout %}">{% trans "sign out" %}</a>
    {% else %}
        <a href="{% url acct_login %}?url={{request.path}}">{% trans "Login" %}</a>
{% ifsetting ACCOUNT_OPEN_SIGNUP %}{% trans "or" %} <a href="{% url acct_signup %}"><strong>{% trans "Sign up" %}</strong></a>{% endifsetting %}
    {% endif %}
	</div>
	{% endifnotequal %}
{% endblock %}

{% block logo_link_image %}<a href="{% url home %}"><img src="{{ STATIC_URL }}images/logos/title-graphic.png" alt="Engineers Without Borders" border="0" title="...and behind the scenes, 100% more awesome." /></a>{% endblock %}

{% block myewb_link_image %}{#<img src="{{ STATIC_URL }}images/myewb_logo.png" width="182" height="52" alt="MyEWB"/>#}{% endblock %}


{% block right_tabs %}
    <ul class="tabs">{% spaceless %}
        <li><a id="tab_home" class="blue" href="{% url home %}">{% trans "Home" %}</a></li>
        {% if user.is_authenticated %}
            <li><a id="tab_profile" class="green" href="{% url profile_detail user %}">{% trans "Profile" %}</a></li>
        {% else %}
            <li><a id="tab_profile" class="green" href="{% url acct_signup %}">{% trans "Sign Up" %}</a></li>
        {% endif %}
        <li><a id="tab_networks" class="yellow" href="{% url networks_index %}">{% trans "Chapters" %}</a></li>
        <li><a id="tab_communities" class="orange" href="{% url communities_index %}">{% trans "Communities" %}</a></li>
        <li><a id="tab_events" class="red" href="{% url events_all %}">{% trans "Events" %}</a></li>
        <li><a id="tab_volunteering" class="purple" href="{% url volunteering_index %}">{% trans "Volunteering" %}</a></li>
    {% endspaceless %}</ul>
{% endblock %}

{% block subnav %}
{% endblock %}

{% block footer %}
<ul class="legal">
	<li><a href="{% url terms %}">Terms of Use</a></li>
	<li><a href="{% url privacy %}">Privacy Policy</a></li>
    <li>&copy; 2005&ndash;{% now "y" %} <a href="http://www.ewb.ca/">{% trans "EWB-ISF Canada" %}</a></li>
	{% if user.is_staff %}<li><a href="/admin/">{% trans "Admin" %}</a></li>{% endif %}
	{% block locale_switcher %}
		<li>
	    <form action="{% if request.user.is_authenticated %}{% url acct_language_change %}{% else %}/i18n/setlang/{% endif %}" method="post" id="locale_switcher">
	        <select name="language" onchange="$('#locale_switcher').submit()">
	            {% for lang in LANGUAGES %}
	                <option value="{{ lang.0 }}"{% ifequal lang.0 LANGUAGE_CODE %} selected="selected"{% endifequal %}>{{ lang.1 }}</option>
	            {% endfor %}
	        </select>
	    </form>
		</li>
	{% endblock %}
</ul>

{% include "feedbackform.html" %}





{% endblock %}

{% block extra_body_base %}
    {% urchin %}    
    {% block extra_body %}{% endblock %}
{% endblock %}
