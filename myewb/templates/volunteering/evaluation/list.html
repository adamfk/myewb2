{% extends "volunteering/base.html" %}

{% load sorting_tags pagination_tags %}
{% load truncate helpers %}
{% load boolean_icon %}

{% block head_title %}
Volunteering Â» Evaluations
{% endblock %}

{% block body %}
<style>
table {
  width: 100%;
}
th {
  text-align: left;
}
th, td {
  padding: 5px;
  border: 1px solid;
}
</style>

<h2>{{ session.name }}</h2>

<div id="evaluation-tabs">
	<ul>
		<li><a href="#complete">Complete evaluations</a></li>
		<li><a href="#draft">Draft evaluations</a></li>
	</ul>

	<div id="complete">
        <h2>Complete evaluations</h2>
        
        {% autosort complete %}
        <form action="{% url evaluation_bulkedit session.id %}" method="post">
		<table>
			<tr>
       			<th>&nbsp;</th>
			    <th>{% anchor status "Status" %}</th>
				{% comment %}
			    <th>{% anchor profile.last_name "Name" %}</th>
       			<th>{% anchor profile.gender "Gndr" %}</th>
       			<th>{% anchor profile.language "Lang" %}</th>
       			<th>{% anchor gpa "GPA" %}</th>
       			{% endcomment %}
			    <th>Name</th>
       			<th>Gndr</th>
       			<th>Lang</th>
       			<th>GPA</th>
       			<th>{% anchor evaluation.total_score "Total" %}</th>
       			{% for c in session.evaluationcriterion_set.all %}
       			    <th>{{ c.column_header }}</th>
       			{% endfor %}
			</tr>
			
			{% for app in complete %}
				<tr style="{% cycle 'background: #ffffff;' 'background: #eee;' %}">
					<td><input type="checkbox" name="app-{{app.id}}"/></td>
					<td>{% for a,b in app.APPLICATION_STATUS %}{% ifequal a app.status %}{{b}}{% endifequal %}{% endfor %}</td>
					<td><a href="{% url evaluation_detail app.id %}">{{ app.profile.last_name}}, {{ app.profile.first_name }}</a></td>
					<td>{{ app.profile.gender }}</td>
					<td>{{ app.profile.lang }}</td>
					<td>{{ app.gpa }}</td>
					<td>{{ app.evaluation.total_score|default_if_none:"&nbsp;" }}</td>
					{% for c in session.evaluationcriterion_set.all %}
   					    <td>{% for k, v in app.evaluation.criteria.items %}{% ifequal k c.id %}{{v}}{% endifequal %}{% endfor %}</td>
    				{% endfor %}
				</tr>
			{% endfor %}
		</table>
		<br/>
		With selected applications: 
		<select name="action">
			<option name="email">send an email</option>
			<option name="state-accept">accept for interview</option>
			<option name="state-interviewed">interview complete</option>
			<option name="state-hire">hire</option>
			<option name="state-reject">reject</option>
		</select>
		&nbsp;&nbsp;
		<input type="submit" value="submit" class="ui-widget ui-button ui-state-default ui-corner-all"/>
		</form>
		
	</div>
	
	<div id="draft">
	    <h2>Draft applications</h2>
		<table>
			<tr>
       			<th>&nbsp;</th>
			    <th>Name</th>
       			<th>Gender</th>
       			<th>Lang</th>
			</tr>
			
			{% for app in draft %}
				<tr style="{% cycle 'background: #ffffff;' 'background: #eee;' %}">
					<td><input type="checkbox"/></td>
					<td><a href="{% url evaluation_detail app.id %}">{{ app.profile.last_name}}, {{ app.profile.first_name }}</a></td>
					<td>{{ app.profile.gender }}</td>
					<td>{{ app.profile.lang }}</td>
				</tr>
			{% endfor %}
		</table>
	</div>
</div>
		
{% endblock %}

{% block extra_body %}
<script type="text/javascript">
	$().ready(function() {
		$("#evaluation-tabs").tabs({
			show: function(event, ui) {
				parent.location.hash = ui.panel.id;
			}
		});
	});
</script>
{% endblock %}

		

